'use strict';

const path = require('path');
const crypto = require('crypto');
const gen = require('easy-generator');
const Promise = require('bluebird');
const _exec = require("child_process").exec;

const TEMPLATES_DIR = path.join(__dirname, '../templates');

const DATA_DEFAULTS = {
    // required
    mongoURI: undefined,

    // optional
    name: 'Site',
    description: '',
    version: '1.0.0',
    author: '',
    nodeVersion: '7.8',
    emcaVersion: '2017',

    BCRYPT_PASSWORD_SALT_ROUNDS: 10,

    // autogenerated
    JWT_SECRET: undefined,
};

function genJWTSecret () {
    return crypto.randomBytes(256).toString('base64');
}

function create ({
    outputDir,
    data,
    template,
    skipCompileForFileExtensions,
    explicitCompilePaths,
}) {
    const mergedData = Object.assign({}, DATA_DEFAULTS, { JWT_SECRET: genJWTSecret() }, data);
    return gen({ data: mergedData, templateDir: path.join(TEMPLATES_DIR, template), outputDir, skipCompileForFileExtensions, explicitCompilePaths });
}

module.exports = create;
